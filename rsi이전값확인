import time
import pyupbit
import datetime
import schedule
from fbprophet import Prophet
import requests
import pandas as pd
import webbrowser

access = "4XJ0xegCx1iTlI7EJq0jxvP3YW1NXnjmxutPLQAO"
secret = "xfQYWVxTXl8nolwLumpxXeleIxxSfzdLHXgKdPIB"

# 로그인
upbit = pyupbit.Upbit(access, secret)

def rsi(ohlc: pd.DataFrame, period: int = 14):
    ohlc["trade_price"] = ohlc["trade_price"]
    delta = ohlc["trade_price"].diff()
    gains, declines = delta.copy(), delta.copy()
    gains[gains < 0] = 0
    declines[declines > 0] = 0

    _gain = gains.ewm(com=(period - 1), min_periods=period).mean()
    _loss = declines.abs().ewm(com=(period - 1), min_periods=period).mean()

    RS = _gain / _loss
    return pd.Series(100 - (100 / (1 + RS)), name="RSI")

while True:
    url = "https://api.upbit.com/v1/candles/minutes/3"
    querystring = {"market":"KRW-BTC","count":"200"}
    response = requests.request("GET", url, params=querystring)
    data = response.json()
    df = pd.DataFrame(data)
    df=df.reindex(index=df.index[::-1]).reset_index()
    bit_mask = df['index'] > 0
    #print(df[bit_mask])
    #print(df)
    nrsi = rsi(df[bit_mask], 14).iloc[-1]
    print("현재 rsi : "+ str(nrsi))
    time.sleep(1)
